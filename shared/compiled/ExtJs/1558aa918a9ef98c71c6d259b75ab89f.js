
let buttonAdd,buttonEdit,buttonDelete;let credentials;Ext.onReady(function(){Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="side";credentials=atob(CREDENTIAL_DATA);credentials=(credentials=="")?"":JSON.parse(credentials);let closeWindow=function(){try{storeListGroupMail.load();Ext.getCmp("windowGroupMail").hide();buttonEdit.disable();buttonDelete.disable();}catch(error){Ext.MessageBox.alert("Error in the code.",error);}};let storeListGroupMail=new Ext.data.JsonStore({"proxy":new Ext.data.HttpProxy({"method":"GET","url":URI_ENDPOINT+"thermoMsc/groupMail/list","headers":{"Authorization":"Bearer "+credentials.access_token}}),"root":"data","autoDestroy":true,"totalProperty":"total","remoteSort":true,"fields":["GRP_UID","GRP_TITLE","GRP_MAIL"]});let storeGroupList=new Ext.data.JsonStore({"fields":["GRP_UID","GRP_TITLE"],"data":GROUPWF});let newGroupMail=function(){try{windowGroupMail.show();Ext.getCmp("formGroupMailName").setValue("");Ext.getCmp("formGroupMailEmail").setValue("");windowGroupMail.setTitle("New GroupMail");formGroupMail.getForm().reset();}catch(error){Ext.MessageBox.alert("Error in the code.",error);}};let editGroupMail=function(){try{let dataGroupMail=gridGroupMail.getSelectionModel().getSelected();formGroupMail.getForm().reset();Ext.getCmp("formGroupMailName").setValue(dataGroupMail.json["GRP_UID"]);Ext.getCmp("formGroupMailEmail").setValue(dataGroupMail.json["GRP_MAIL"]);windowGroupMail.setTitle("Edit GroupMail");windowGroupMail.show();}catch(error){Ext.MessageBox.alert("Error: "+error+".");}};let deleteGroupMail=function(){try{let dataGroupMail=gridGroupMail.getSelectionModel().getSelected();let groupMailUid=dataGroupMail.json["GRP_UID"];Ext.Msg.confirm('Delete Mail Group?','Are you sure you want to remove selected mail group?',function(btn){if(btn==='yes'){Ext.Ajax.request({"method":"DELETE","url":URI_ENDPOINT+"thermoMsc/groupMail/"+groupMailUid,"headers":{"Authorization":"Bearer "+credentials.access_token},"beforeSend":function(request){try{request.setRequestHeader("Authorization","Bearer "+credentials.access_token);}catch(error){Ext.MessageBox.alert("Error in the code.",error);}},"success":function(response,resp){try{let jsonMessage=Ext.util.JSON.decode(response.responseText);let errorDelete=jsonMessage.error||null;if(errorDelete==null){Ext.msgBoxSlider.msg("Success","The location record has been deleted.","success");}else{Ext.msgBoxSlider.msg("Warning",errorDelete,"warning");}
storeListGroupMail.load();buttonEdit.disable();buttonDelete.disable();}catch(error){Ext.MessageBox.alert("Error in the code.",error);}},"failure":function(response,resp){try{Ext.MessageBox.alert("Alert!!","There is an error.");}catch(error){Ext.MessageBox.alert("Error in the code.",error);}}});}});}catch(error){Ext.MessageBox.alert("Error: "+error+".");}};let formGroupMail=new Ext.FormPanel({"id":"formGroupMail","frame":true,"items":[{"id":"formGroupMailUid","name":"groupMailUid","xtype":"textfield","hidden":true},new Ext.form.ComboBox({"id":"formGroupMailName","name":"groupMailName","fieldLabel":"Group Name  (<span style='color:red;'>*</span>)","store":storeGroupList,"valueField":"GRP_UID","displayField":"GRP_TITLE","typeAhead":true,"mode":"local","triggerAction":"all","emptyText":"Select Group","selectOnFocus":true,"width":320,"allowBlank":false,"forceSelection":true,"editable":true,}),{"id":"formGroupMailEmail","name":"groupMailEmail","xtype":"textfield","fieldLabel":"Email (<span style='color:red;'>*</span>)","maxLength":255,"enforceMaxLength":false,"width":320,"allowBlank":false}],"buttons":[{"text":"Save","handler":function(){try{if(Ext.getCmp("formGroupMail").getForm().isValid()){let url,method;let groupMailUid=formGroupMail.getForm().findField("formGroupMailName").getValue();let dataGroupMailCommon={"GRP_UID":Ext.getCmp("formGroupMailName").getValue(),"GRP_MAIL":Ext.getCmp("formGroupMailEmail").getValue(),};let messageSuccessSaved="";method="POST";url=URI_ENDPOINT+"thermoMsc/groupMail/"+groupMailUid;dataGroupMail=Object.assign(dataGroupMailCommon,{"GRP_UID":groupMailUid});messageSuccessSaved="The groupMail record has been modified.";Ext.Ajax.request({"url":url,"method":method,"type":"ajax","headers":{"Authorization":"Bearer "+credentials.access_token},"beforeSend":function(request){request.setRequestHeader("Authorization"," Bearer "+credentials.access_token);},"jsonData":dataGroupMail,"success":function(obj,resp){closeWindow();let jsonMessage=Ext.util.JSON.decode(resp.responseText);Ext.msgBoxSlider.msg("Success",messageSuccessSaved,"success");},"failure":function(obj,resp){}});}else{Ext.MessageBox.alert("Alert","You have to complete the fields");}}catch(error){Ext.MessageBox.alert("Error in the code.",error);}}},{"text":"Cancel","handler":closeWindow}],"labelWidth":180});buttonAdd=new Ext.Action({"text":"New","iconCls":"button_menu_ext ss_sprite ss_add","handler":newGroupMail});buttonEdit=new Ext.Action({"text":"Edit","iconCls":"button_menu_ext ss_sprite  ss_pencil","handler":editGroupMail,"disabled":true});buttonDelete=new Ext.Action({"text":"Delete","iconCls":"button_menu_ext ss_sprite  ss_delete","handler":deleteGroupMail,"disabled":true});let windowGroupMail=new Ext.Window({"title":"Group Mail","close":"hide","closeAction":'hide',"autoHeight":true,"modal":true,"closable":true,"width":550,"items":[formGroupMail],"id":"windowGroupMail"});let tbarSearch=[buttonAdd,"-",buttonEdit,buttonDelete,{"xtype":"tbfill"},"->",new Ext.ux.form.SearchField({"store":storeListGroupMail,"width":250})];let pageSize=parseInt(PAGED_AMOUNT);let storePageSize=new Ext.data.SimpleStore({"autoLoad":true,"fields":["size"],"data":[["20"],["30"],["40"],["50"],["100"]]});let comboPageSize=new Ext.form.ComboBox({"typeAhead":false,"mode":"local","triggerAction":"all","store":storePageSize,"valueField":"size","displayField":"size","width":50,"editable":false,"listeners":{select:function(current,dataCombo){pagingSearchList.pageSize=parseInt(dataCombo.data["size"]);pagingSearchList.moveFirst();}}});comboPageSize.setValue(pageSize);let pagingSearchList=new Ext.PagingToolbar({"pageSize":pageSize,"store":storeListGroupMail,"displayInfo":true,"autoHeight":true,"displayMsg":"Showing "+" {0} - {1} "+"of"+" {2} ","emptyMsg":"There are no cases filed","items":[comboPageSize]});let selectModelList=new Ext.grid.CheckboxSelectionModel({"singleSelect":true,"listeners":{"rowselect":function(){buttonEdit.enable();buttonDelete.enable();},"rowdeselect":function(){buttonEdit.disable();buttonDelete.disable();}}});let gridGroupMail=new Ext.grid.GridPanel({"title":"List of Groups","store":storeListGroupMail,"tbar":tbarSearch,"bbar":pagingSearchList,"region":"center","margins":"0 0 0 0","loadMask":true,"sm":selectModelList,"cm":new Ext.grid.ColumnModel({"defaults":{"sortable":true},"columns":[{"id":"GRP_UID","dataIndex":"GRP_UID","hidden":true,"hideable":false},{"header":"Group Name","width":40,"dataIndex":"GRP_TITLE"},{"header":"Email","width":40,"dataIndex":"GRP_MAIL"},]}),"border":false,"autoShow":true,"autoFill":true,"nocache":true,"autoWidth":true,"stripeRows":true,"stateful":true,"animCollapse":true,"enableColumnResize":true,"enableHdMenu":true,"columnLines":true,"viewConfig":{"forceFit":true,"emptyText":"<div align='center' style='margin-left: -40%;'><b> Sorry ,the criteria has not been found. </b></div>"},"listeners":{"rowclick":function(grid,rowIndex){rowSelected=gridGroupMail.getSelectionModel().getSelected();},"rowdblclick":editGroupMail}});new Ext.Viewport({"layout":"border","border":false,"items":[gridGroupMail]});storeListGroupMail.load();});